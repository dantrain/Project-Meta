define(["app/flip","app/swing","app/reveal","knockout-2.2.1","jquery"],function(e,t,n,r,i){return function(){var s=this;s.albums=r.observableArray(),s.scorerange=r.observableArray([70,100]),s.criticreviews=r.observable(10),s.genres=r.observableArray(),s.genrefilter=r.observableArray(),s.genreswitch=r.observable("include"),s.sortby=r.observable("date"),s.modal={isOpen:!1,closingPromise:null},s.closeModal=function(){typeof s.modal.close=="function"&&s.modal.closingPromise===null&&s.modal.close()};var o=!1;i(document).on("keyup",function(e){e.keyCode===27&&!o&&(o=!0,setTimeout(function(){o=!1},500),s.closeModal())}),s.flip=e(s.modal),s.swing=t(s.modal),s.reveal=n(s.modal);var u=[{name:"iTunes",string:"http://itunes.com/{artist}/{title}",separator:""},{name:"Google Play",string:"https://play.google.com/store/search?q={artist}+{title}&c=music",separator:"+"},{name:"Last.fm",string:"http://www.last.fm/search?q={artist}+{title}&from=ac",separator:"+"},{name:"Spotify",string:"spotify:search:artist:{artist}+album:{title}",separator:"+"},{name:"Grooveshark",string:"http://grooveshark.com/#!/search/album?q={artist}+{title}",separator:"+"},{name:"Rdio",string:"http://www.rdio.com/search/{artist}%20{title}/albums/",separator:"%20"}];if(Modernizr.localstorage){var a=localStorage.services;typeof a!="undefined"&&(u=u.concat(JSON.parse(a)))}s.services=r.observableArray(u),s.maxcriticreviews=r.computed(function(){var e=s.albums();return e.length===0?40:Math.max.apply(Math,e.map(function(e){return e.critic_number}))}),s.filter=r.computed(function(){return{scorerange:s.scorerange(),criticreviews:s.criticreviews(),genrefilter:s.genrefilter(),genreswitch:s.genreswitch(),sortby:s.sortby()}}).extend({throttle:150})}});