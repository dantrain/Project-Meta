define(["jquery"],function(e){return function(t){var n,r,i,s,o,u,a,f=e("#overlay"),l=!1,c=function(){t.isOpen=!0,t.close=h,t.closingPromise=null,n=e(s.currentTarget),r=n.parent(),i=n.next();var c=/matrix\(\d+, \d+, \d+, \d+, (\d+), (\d+)\)/i,p=r.css("transform").match(c);p===null&&(c=/matrix3d\(\d+, \d+, \d+, \d+, \d+, \d+, \d+, \d+, \d+, \d+, \d+, \d+, (\d+), (\d+), \d+, \d+\)/i,p=r.css("transform").match(c),p===null&&(l=!0,r.removeClass("isotope-item").addClass("is-flipping is-flipped is-translating"),n.hide(),f.show().addClass("is-semitransparent"))),p!==null&&(o=e(".items").offset(),u=o.left+parseInt(p[1],10),a=o.top+parseInt(p[2],10),r.removeClass("isotope-item"),r.addClass("is-flipping").css({left:u,top:a-e(window).scrollTop()}),f.show(),setTimeout(function(){f.addClass("is-semitransparent"),r.addClass("is-flipped is-translating")},50))},h=function(){var i=e.Deferred();return t.closingPromise=i.promise(),t.isOpen&&!l?(r.css("top",a-e(window).scrollTop()),r.removeClass("is-flipped"),f.removeClass("is-semitransparent"),setTimeout(function(){f.hide(),r.removeClass("is-flipping is-translating").css({left:0,top:0}),setTimeout(function(){r.addClass("isotope-item"),t.isOpen=!1,i.resolve()},50)},400)):t.isOpen&&l?(r.removeClass("is-flipping is-flipped is-translating").addClass("isotope-item"),n.show(),f.hide().removeClass("is-semitransparent"),t.isOpen=!1,i.resolve()):i.resolve(),i.promise()};return function(e,n){var r=t.target;t.target=n.currentTarget,s=n,t.isOpen&&t.target!==r?t.close().done(c):c()}}});